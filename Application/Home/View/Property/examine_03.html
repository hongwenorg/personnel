<div id="plan">
    <style>
        .append_plhead {
            height: 40px;
            background-color: #efefef;
            text-align: left;
            line-height: 40px;
            font-size: 18px;
            font-weight: bold;
            color: dimgray;
            width: 95%;
            margin-left: 2.5%;
        }

        .append_plan {
            width: 95%;
            margin-left: 2.5%;
            border: 1px solid #efefef;
            height: 250px;
        }

        .append_plan_body > ul > li {
            width: 320px;
            height: 25px;
            line-height: 25px;
            float: left;
            text-align: left;
            margin-left: 50px;
            margin-top: 10px;
            font-weight: bold;
            font-family: "微软雅黑";
            color: dimgray;
        }

        .append_plan_body > ul > li > input {
            width: 190px;
            float: right;
            height: 22px;
            border-top: none;
            border-left: none;
            border-right: none;
            border-bottom: 2px solid dimgray;
            border-radius: 10px;
            outline: none;
            padding-left: 10px;
        }

        .append_plan_body > ul > li > select {
            height: 25px;
            width: 200px;
            float: right;
            border-top: none;
            border-left: none;
            border-right: none;
            border-bottom: 2px solid dimgray;
            border-radius: 10px;
            outline: none;
            padding-left: 10px;
        }

        .append_plan_foot {
            padding-left: 155px;
            width: 100%;
        }

        .append_plhead > input {
            margin-top: 5px;
            float: right;
            width: 100px;
            height: 30px;
            margin-left: 10px;
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            font-size: 15px;
        }

        .tj_apply, .delet_apply {
            margin-top: 5px;
            float: right;
            width: 100px;
            height: 30px;
            margin-left: 10px;
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            font-size: 15px;
        }

        .plan_xiugai {
            width: 50px;
            background-color: #00c8c8;
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            font-size: 15px;
        }

        .foot_baocun, .tj_apply {
            background-color: #00c8c8;
        }

        .foot_qingkong, .delet_apply {
            background-color: #ed5565;
        }

        .hidden_input {
            text-align: center;
            width: 100%;
            height: 30px;
            font-size: 16px;
            border: none;
        }

        .plan_date {
            height: 40px;
            text-align: center;
            margin-top: 15px;
            margin-bottom: 10px;
            line-height: 40px;
            font-size: 18px;
            font-weight: bold;
            color: dimgray;
        }

        .plan_date > input {
            width: 190px;
            height: 22px;
            font-size: 18px;
            border-top: none;
            border-left: none;
            border-right: none;
            border-bottom: 2px solid dimgray;
            border-radius: 10px;
            outline: none;
            padding-left: 10px;
        }

        #city {
            width: 195px !important;
        }

    </style>
    <link rel="stylesheet" href="/public/css/Content_staff.css" type="text/css">
    <script type="text/javascript" src="/public/js/jquery.js"></script>

    <!--*********************************************存放后台员工信息*****************************************************-->
    <div class="plan_date">
        选择期次：<input type="month" id="plan_date" value="">
    </div>
    <div class="append_plhead">
        申请审核：
    </div>
    <div class="sousuokuang" id="sousuokuang" style="left:2.5%;margin-top:10px;margin-bottom: 10px">
        <!--<div class="prov_boder">-->
        <select name="" id="prov">
            <option value="0">按条件搜索</option>
            <option value="plan_type">计划类型</option>
            <option value="subject">科目类别</option>
            <option value="name">申请人</option>
        </select>
        <!--</div>-->
        <select name="" id="city"></select>
        <span id='prov_append'></span>
        <button type="button" id="find_btt" style="float:right"><img src="/public/img/sousuo.png" class="sou_suo"
                                                                     alt=""></button>
        <!--时间控件-->
    </div>
    <div style="width:95%;margin-left:2.5%;overflow-x: scroll">
        <form method="post" id="myform_two" onSubmit="return false;">
            <table class="tb" cellpadding="2" cellspacing="0" id="tb">
                <tr class="trr1" style="min-width:50px ">
                    <th style="min-width:50px">
                        <div><input type="checkbox" class="checkbox_all" id="checkbox_all">
                            <label for="checkbox_all">全选</label></div>
                    </th>
                    <th style="min-width:40px">
                        <div>序号</div>
                    </th>
                    <th style="min-width:200px">
                        <div>项目阶段</div>
                    </th>
                    <th>
                        <div>审核状态</div>
                    </th>
                    <th id="">
                        <div>审核部门</div>
                    </th>
                    <th id="" style="min-width:60px">
                        <div>计划类型</div>
                    </th>
                    <th id="" style="min-width:180px">
                        <div>申请校区</div>
                    </th>
                    <th id="" style="min-width:180px">
                        <div>归属校区</div>
                    </th>
                    <th id="" style="min-width:180px">
                        <div>接收校区</div>
                    </th>
                    <th id="" style="min-width:180px">
                        <div>科目类型</div>
                    </th>
                    <th>
                        <div>明细内容</div>
                    </th>
                    <th>
                        <div>单位</div>
                    </th>
                    <th style="min-width:60px">
                        <div>数量</div>
                    </th>
                    <th>
                        <div>合计</div>
                    </th>
                    <th>
                        <div>实际支出</div>
                    </th>
                    <th>
                        <div>支出说明</div>
                    </th>
                    <th>
                        <div>接收人</div>
                    </th>
                    <th style="min-width:210px">
                        <div>接收卡号</div>
                    </th>
                    <th>
                        <div>期望审批日期</div>
                    </th>
                    <th>
                        <div>申请人</div>
                    </th>
                    <th>
                        <div>采购类型</div>
                    </th>
                    <th>
                        <div>品牌</div>
                    </th>
                    <th>
                        <div>型号</div>
                    </th>
                    <th>
                        <div>物流</div>
                    </th>
                    <th>
                        <div>备注</div>
                    </th>
                    <th style="min-width:200px">
                        <div>预算审批时间</div>
                    </th>
                    <th style="min-width:200px">
                        <div>最后审核时间</div>
                    </th>
                    <th style="min-width:200px">
                        <div>数据创建时间</div>
                    </th>
                </tr>
            </table>
        </form>
    </div>
    <input type="hidden" name="" value='1' id='page_page'>
    <!--**********************************************分页签，上一页/下一页***********************************************-->
    <input type='button' value='首页' class='page_top' id="page_min" style="display:block">
    <input type="button" value="上一页" class='page_top' id="page_u" style="display:block">

    <div id='page_all'></div>
    <input type="button" value="下一页" class='page_top' id="page_d" style="display:block">
    <input type='button' value='尾页' class='page_top' id="page_max" style="display:block">

    <div id="pageall" style="display:block"></div>
    <div style="width:95%;margin-left:2.5%">
        <input type="button" style="margin-top: 30px" value="删除" class="delet_apply" id="delet_apply"/>
        <input type="button" style="margin-top: 30px" value="退回" class="tj_apply"/>
        <input type="button" style="margin-top: 30px" value="通过" id="submit_two" class="tj_apply"/>
    </div>
    <script>
        var examine_03 = function () {
            (function () {
                var arr_staff = [];
                var pageall = document.getElementById("pageall");
                var pagemin = document.getElementById("page_min");
                var pagemax = document.getElementById("page_max");
                var copy_excel = document.getElementById("copy_excel");
                var copy_dayin = document.getElementById("copy_dayin");
                var tb = document.getElementById("tb");
                var find_btt = document.getElementById("find_btt");
                var tb_content = tb.innerHTML;
                var school_option = [];
                var plan_option = [];
                var purchase_option = [];
                var finance_type_option = [];

                document.getElementById('plan_date').valueAsDate = new Date();
                $.ajax({
                    url: "/index.php/Home/Property/plan_list",
                    type: "post",
                    async: false,
                    cache: "false",
                    success: function (data) {
                        msg = JSON.parse(data);

                        for (keys in msg) {
                            for (key in msg[keys]) {
                                if (keys == 'school') {
                                    school_option.push(msg['school'][key]);
                                } else if (keys == 'plan') {
                                    plan_option.push(msg['plan'][key]);
                                } else if (keys == 'purchase') {
                                    purchase_option.push(msg['purchase'][key]);
                                } else if (keys == 'finance_type') {
                                    finance_type_option.push(msg['finance_type'][key]);
                                }
                            }
                        }
                    }

                });

//******************************     全局变量  end    ***************************


                //*****************************     select列表，input，日期 切换 start     ***********************
                document.getElementById("prov").addEventListener("change", function () {
                    var porv_val = document.getElementById("prov").value;
                    var opt = "";
                    var sel = document.getElementById("prov");
                    if (porv_val == "0") {
                        document.getElementById("prov_append").innerHTML = "";
                        document.getElementById("city").style.display = "none";
                    } else if (porv_val == "name") {
                        document.getElementById("prov_append").innerHTML = "<input type='text' id='find'>";
//                        var find_name = document.getElementById("find");
                        document.getElementById("city").style.display = "none";
                    } else if (sel.value == "plan_type") {
                        for (var i = 0; i < plan_option.length; i++) {
                            opt = opt + '<option value="' + plan_option[i].id + '">' + plan_option[i].plan_name + '</option>';
                            document.getElementById("city").innerHTML = opt;
                            city.style.display = "block";
                            document.getElementById("prov_append").innerHTML = "";
                        }
                    } else if (sel.value == "subject") {
                        for (var i = 0; i < finance_type_option.length; i++) {
                            opt = opt + '<option value="' + finance_type_option[i].id + '">' + finance_type_option[i].name + '</option>';
                            document.getElementById("city").innerHTML = opt;
                            city.style.display = "block";
                            document.getElementById("prov_append").innerHTML = "";
                        }
                    }
                    document.getElementById("city").innerHTML = opt;

                });
//*****************************     select列表，input，日期 切换 end     ***********************
                /*
                 * 循环显示内容函数
                 * page=分页页码
                 * num=排序正反
                 * content=点击要排序字段
                 * start
                 * */
                function ArrSort() {
                    len = arr_staff.length;
                    var arr_num = [];
                    for (var l = 0; l < len; l++) {
                        arr_num[l] = l + 1;
                    }
                    for (var j = 0; j < len; j++) {
                        var tr = document.createElement("tr");
                        tb.appendChild(tr).innerHTML = "<td class='td_sty'><input type='checkbox' name='check_box" + arr_staff[j].id + "' value='" + arr_staff[j].id + "' class='plan_checkbox'>" + "</div>" + "</td>" +
                                "<td class='td_sty'>" + "<div>" + arr_num[j] + "</div>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].project_type + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].check_name + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + "" + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].plan_name + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].class_post_plan + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].class_post_plan + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].receive_school + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].finance_type_name + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].info + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].unit + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].count + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].money + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].money_last + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].notes + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].receive_user + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].receive_card + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].expect_date + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].add_user_name + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].purchase_name + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].buy_brand + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].buy_info + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].buy_transport + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].other + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].money_time + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].update_time + "' class='hidden_input' id='' name=''>" + "</td>" +
                                "<td class='td_sty'>" + "<input type='text' readonly='readonly' value='" + arr_staff[j].create_time + "' class='hidden_input' id='' name=''>" + "</td>";
                        pageall.style.display = "block";
                        pageall.style.display = "block";
                        pagemin.style.display = "block";
                        pagemax.style.display = "block";
                    }

                    /*
                     //下面是分页处理
                     CountPage = arr_staff.length % PageSize === 0 ? (arr_staff.length / PageSize) : (parseInt(arr_staff.length / PageSize) + 1);
                     var page_current = (parseInt(page) + 1);
                     var page_top = "page_top";
                     var page_next = "page_next";
                     if (document.getElementById("page_min").style.display=="block") {
                     page_str = "<input t pe='button' value='上一页' class='page_top' id='page_top'>";
                     }else if(tb.innerHTML==""){
                     document.getElementById("page_min").display="none";
                     document.getElementById("page_max").display="none";
                     document.getElementById("page_all").display="none";
                     }
                     for (var page_i = 0; page_i <= page_current; page_i++) {
                     page_str += "<span class='page' id='page" + (page_i) + "'>" + (page_i) + "</span>";
                     }
                     if (document.getElementById("page_min").style.display=="block") {
                     page_str += "<input type='button' class='page_next' value='下一页' id='page_next'>";
                     }
                     $("#page_all").html(page_str);
                     document.getElementById("page" + page_current).style.backgroundColor = "#00c8c8";
                     document.getElementById("pageall").innerHTML = "共" + CountPage + "页";*/
                }


//分页处理搜索数据等  end

                //期次的选择（当这个文本框失去鼠标时触动）执行搜索
                document.getElementById('plan_date').onblur = function () {
                    find_btt.click();
                };

//员工信息页面搜索按钮  start
                find_btt.onclick = function () {
                    var page = $("#page_page").val();
                    var sel = document.getElementById("prov");
                    if (sel.value == "plan_type") {
                        var status = "plan_id";
                        var content = $("#city").val();
                    } else if (sel.value == "subject") {
                        var status = "finance_type_id";
                        var content = $("#city").val();
                    } else if (sel.value == "name") {
                        var status = "add_user_name";
                        var content = $("#find").val();
                    }
                    var month = $("#plan_date").val();
                    $("#tb tr:not(:first)").empty();
                    arr_staff = [];
                                  $.ajax({
                        url: "/index.php/Home/Property/plan_table_page",
                        data: {
                            'status_name': '总裁审核,总裁确认',
                            'status': status,
                            'content': content,
                            "month": month,
                            'page': page
                        },
                        type: "post",
                        async: "false",
                        traditional: "true",
                        cache: "false",
                        success: function (data) {
                            document.getElementById("sousuo_img_out").style.display = "none";
                            var msg = JSON.parse(data);
                            for (key in msg) {
                                if (key != "status" && key != "page_arr" && msg["status"] != 2) {
                                    arr_staff.push(msg[key]);
                                }
                            }
                            console.log(msg['page_arr']);
                            if (msg["status"] != 2) {
                                ArrSort();
                            } else {
                                document.getElementById("sousuo_img_out").style.display = "none";
                                document.querySelector(".hongwen_logo").style.display = "block";
                            }
                            var page_num = [];
                            for (var i = 0; i < msg["page_arr"].page_count; i++) {
                                var page_one = document.createElement("span");
                                page_num[i] = i + 1;
                                page_one.setAttribute("class", "page");
                                page_one.innerText = parseFloat(page_num[i]);
                                document.getElementById("page_all").appendChild(page_one);
                                var page_parent=page_one.parentNode;
                                if(page_one.innerText==msg["page_arr"].page){
                                    page_one.style.background="#00c8c8";
                                }
                                if(page_one.innerText<parseFloat(msg["page_arr"].page)-2){
                                    page_parent.removeChild(page_one);
                                }
                                if(page_one.innerText>parseFloat(msg["page_arr"].page)+2){
                                    page_one.style.display="none";
                                    page_parent.removeChild(page_one);

                                }
                            }
                            document.getElementById("pageall").innerText="共"+ msg["page_arr"].page_count+"页";
                            $(".page").click(function () {
                                $("#tb tr:not(:first)").empty();
                                document.getElementById("page_all").innerHTML = "";
                                $("#page_page").val($(this).text());
                                find_btt.click();
                            });
//                            var page_up=document.querySelectorAll(".page_top");
//                            for(var j=0;j<page_up.length;j++){
//                                page_up[j].addEventListener("click",function(e){
//                                    var target= e.target;
//                                    if(target.value=="首页"){
//                                        $("#page_page").val(1);
//                                        $("#tb tr:not(:first)").empty();
//                                        find_btt.click();
//                                    }
//                                })
//
//                            }
                            document.getElementById("page_min").onclick=function(){
                                document.getElementById("page_all").innerHTML = "";
                                $("#page_page").val(1);
                                find_btt.click();
                            };
                            document.getElementById("page_max").onclick=function(){
                                document.getElementById("page_all").innerHTML = "";
                                $("#page_page").val(msg["page_arr"].page_count);
                                find_btt.click();
                            };
                            document.getElementById("page_u").onclick=function(){
                                document.getElementById("page_all").innerHTML = "";
                                $("#page_page").val(parseFloat(msg["page_arr"].page)-1);
                                find_btt.click();
                            };
                            document.getElementById("page_d").onclick=function(){
                                $("#page_page").val(parseFloat(msg["page_arr"].page)+1);
                                if($("#page_page").val()<=parseFloat(msg["page_arr"].page_count)){
                                    document.getElementById("page_all").innerHTML = "";
                                    find_btt.click();
                                }
                            };



                        }
                    });
                };

                find_btt.click();
                var checkbox_all = document.querySelector(".checkbox_all");
                var check_num = 0;
                checkbox_all.onclick = function () {
                    check_num += 1;
                    var plan_checkbox = document.querySelectorAll(".plan_checkbox");
                    for (var i = 0; i < plan_checkbox.length; i++) {
                        if (check_num % 2 != 0) {
                            plan_checkbox[i].checked = true;
                        } else {
                            plan_checkbox[i].checked = false;
                        }
                    }
                };
                document.getElementById("delet_apply").onclick = function () {
                    var plan_checkbox = document.querySelectorAll(".plan_checkbox");
                    for (var i = 0; i < plan_checkbox.length; i++) {
                        if (plan_checkbox[i].checked == true) {
                            if (confirm("是否删除所选内容")) {
                                var remove_parenod = plan_checkbox[i].parentNode.parentNode.parentNode;
                                remove_parenod.parentNode.removeChild(remove_parenod);
                            }
                        }
                    }
                };

                //申请审核页删除操作
                $("#delet_apply").click(function () {
                    if (confirm("是否删除所选内容")) {
                        var data = $('#myform_two').serialize();//将表单数据以字符串形式获取
                        $.ajax({
                            url: "/index.php/Home/Property/plan_del",
                            data: {'data': data},
                            type: "post",
                            async: "false",
                            traditional: "true",
                            cache: "false",
                            success: function (msg) {
                                if (msg == 1) {
                                    alert("删除成功！");
                                    find_btt.click();
                                } else if (msg == 2) {
                                    alert("删除失败！");
                                } else if (msg == 3) {
                                    alert("删除失败,请选择要提交的项目！");
                                }

                            }

                        });
                    }
                });


                //申请审核页提交神请操作
                $("#submit_two").click(function () {
                    var data = $('#myform_two').serialize();//将表单数据以字符串形式获取
                    $.ajax({
                        url: "/index.php/Home/Property/plan_add",
                        data: {'data': data},
                        type: "post",
                        async: "false",
                        traditional: "true",
                        cache: "false",
                        success: function (msg) {
                            if (msg == 1) {
                                alert("提交成功！");
                                find_btt.click();
                            } else if (msg == 2) {
                                alert("提交失败！");
                            } else if (msg == 3) {
                                alert("保存失败,请选择要提交的项目！");
                            }

                        }

                    });
                });

            })()
        };


    </script>
</div>